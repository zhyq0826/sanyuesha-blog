---
import Layout from "~/layouts/Layout.astro";
import { getCollection } from "astro:content";
import { dateString } from "~/utils";

const tools = (
  await getCollection("tools", ({ data }) =>
    import.meta.env.PROD ? data.draft !== true : true
  )
).sort((a, b) => (a.data.date < b.data.date ? 1 : -1));
---

<Layout title="Tools" description="自用与分享的小工具">
  <section class="space-y-5">
    <h1 class="text-3xl font-semibold text-heading1">Tools</h1>
    {tools.map((item) => (
      <article class="border border-foreground/12 rounded-xl p-5 bg-foreground/2 hover:border-accent/30 transition-colors">
        <div class="text-sm text-foreground/80 flex flex-wrap gap-2 items-center">
          <time>{dateString(item.data.date)}</time>
          <span class="rounded-full px-3 py-1 border border-foreground/16 bg-foreground/3 text-xs">
            v{item.data.version}
          </span>
        </div>
        <h2 class="text-2xl font-semibold mt-2"># {item.data.title}</h2>
        <p class="mt-3 text-foreground/80">{item.data.summary}</p>
        {item.data.tags?.length ? (
          <div class="flex flex-wrap gap-2 mt-3">
            {item.data.tags.map((tag) => (
              <span class="rounded-full px-3 py-1 text-sm border border-foreground/16 bg-foreground/3">
                #{tag}
              </span>
            ))}
          </div>
        ) : null}
        {item.data.changelog?.length ? (
          <div class="mt-3 text-sm text-foreground/80">
            <div class="font-semibold mb-1">Changelog</div>
            <ul class="list-disc pl-5 space-y-1">
              {item.data.changelog.map((line) => (
                <li>{line}</li>
              ))}
            </ul>
          </div>
        ) : null}
        <div class="flex flex-wrap gap-3 mt-4 text-sm">
          {item.data.link && (
            <a class="button" href={item.data.link} target="_blank" rel="noreferrer">
              Demo
            </a>
          )}
          {item.data.download && (
            <a class="button" href={item.data.download} target="_blank" rel="noreferrer">
              Download
            </a>
          )}
        </div>
      </article>
    ))}
    {tools.length === 0 && (
      <div class="border border-foreground/12 rounded-xl p-5 text-foreground/70">
        暂无工具。
      </div>
    )}
  </section>
</Layout>

