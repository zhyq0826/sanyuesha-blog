---
import type { GetStaticPaths } from "astro";
import Layout from "~/layouts/Layout.astro";
import { getCollection, render } from "astro:content";
import { dateString } from "~/utils";

export const getStaticPaths = (async () => {
  const entries = await getCollection("insights", ({ data }) =>
    import.meta.env.PROD ? data.draft !== true : true
  );
  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry }
  }));
}) satisfies GetStaticPaths;

const { entry } = Astro.props;
const { Content, headings } = await render(entry);
const description = entry.data.description ?? entry.data.summary;
---

<Layout title={entry.data.title} description={description} tags={entry.data.tags}>
  <article class="py-6 max-w-full" data-pagefind-body>
    <h1 class="text-3xl font-semibold text-heading1 mb-2"># {entry.data.title}</h1>
    <div class="text-foreground/80 text-sm mb-4">
      <time>{dateString(entry.data.date)}</time>
      {entry.data.tags?.length ? (
        <span class="ml-3 space-x-2">
          {entry.data.tags.map((tag) => (
            <span class="rounded-full px-3 py-1 text-xs border border-foreground/16 bg-foreground/3">
              #{tag}
            </span>
          ))}
        </span>
      ) : null}
    </div>
    <div class="prose">
      <Content />
    </div>
  </article>
</Layout>

