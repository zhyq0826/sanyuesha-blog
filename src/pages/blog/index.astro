---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostMeta from "../../components/PostMeta.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("posts")).sort((a, b) => +b.data.date - +a.data.date);
const groups = Array.from(new Set(posts.map((p) => p.data.group || "未分组")));
---

<BaseLayout title="博客 | 三月沙" description="技术分享与思考，支持分组、时间线与评论。">
  <section style="margin-bottom:1.5rem;">
    <div class="section-title">
      <span>分组</span>
    </div>
    <div style="display:flex;gap:0.75rem;flex-wrap:wrap;">
      {groups.map((g) => (
        <a href={`#${g}`} class="pill">{g}</a>
      ))}
    </div>
  </section>

  {groups.map((group) => (
    <section id={group} style="margin:2rem 0;">
      <div class="section-title">
        <span>{group}</span>
      </div>
      <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));">
        {posts
          .filter((p) => (p.data.group || "未分组") === group)
          .map((post) => (
            <article class="card">
              <a href={`/blog/${post.slug}`} style="display:block;margin-bottom:0.5rem;font-weight:700;letter-spacing:-0.01em;">
                {post.data.title}
              </a>
              <p style="margin:0 0 0.75rem;color:#4b5563;">{post.data.summary}</p>
              <PostMeta date={post.data.date} tags={post.data.tags} group={post.data.group} />
            </article>
          ))}
      </div>
    </section>
  ))}
</BaseLayout>

